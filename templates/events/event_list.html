{% extends "base.html" %}
{% block title %}Event List{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Event Calendar</h1>
    <a href="{% url 'events:event-create' %}" class="add-event-btn">+ Add New Event</a>
</div>

<form method="GET" action="{% url 'events:event-list' %}" class="filters">
    <div class="filter-controls">
        <label>
            Sport:
            <select name="sport">
                <option value="">All</option>
                {% for s in available_sports %}
                    <option value="{{ s }}" {% if s == request.GET.sport %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
            </select>
        </label>

        <label>
            Sort:
            <select name="sort">
                <option value="asc" {% if current_sort == 'asc' %}selected{% endif %}>Oldest</option>
                <option value="desc" {% if current_sort == 'desc' %}selected{% endif %}>Newest</option>
            </select>
        </label>

        <button type="submit">Apply</button>
        {% if request.GET.sport or request.GET.sort == 'desc' %}
            <a href="{% url 'events:event-list' %}" class="btn-secondary">Reset</a>
        {% endif %}
    </div>
</form>

{% if events %}
    {% for e in events %}
    <div class="event">
        <div class="event-header">
            <h2>
                <a href="{% url 'events:event-detail' pk=e.pk %}">
                    {{ e.home_team.name|default:"TBD" }} vs {{ e.away_team.name|default:"TBD" }}
                </a>
            </h2>
            <span class="status">{{ e.status }}</span>
        </div>

        <div class="event-details">
            <p><strong>Date:</strong> {{ e.start_datetime|date:"l, F j, Y" }} at {{ e.start_datetime|time:"P" }}</p>

            {% if e.stage %}
                <p><strong>Competition:</strong> {{ e.stage.competition.sport.name }} | {{ e.stage.competition.name }} ({{ e.stage.name }})</p>
            {% endif %}
            {% if e.venue %}
                <p><strong>Venue:</strong> {{ e.venue.name }}</p>
            {% endif %}
        </div>

        {% if e.status == 'played' %}
        <div class="event-result">
            <p><strong>Result:</strong> {{ e.home_goals|default:"N/A" }} - {{ e.away_goals|default:"N/A" }} (Winner: {{ e.winner.name|default:"N/A" }})</p>
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    <p>No events found{% if request.GET.sport or request.GET.sort %} matching your criteria{% endif %}.</p>
    <p>Try adding a <a href="{% url 'events:event-create' %}">new event</a>.</p>
{% endif %}
{% endblock %}
